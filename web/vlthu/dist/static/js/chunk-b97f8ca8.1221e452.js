(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b97f8ca8"],{"07f0":function(e,t,n){"use strict";var a=n("fa33"),r=n.n(a);r.a},"1ec0":function(e,t,n){"use strict";var a=n("e4fb"),r=n.n(a);r.a},"24d2":function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"g",(function(){return c})),n.d(t,"f",(function(){return u}));var a=n("b775");function r(e){return Object(a["a"])({url:"/project/detail?id=".concat(e),method:"get"})}function o(e){return Object(a["a"])({url:"/check/ViewApplyInfo?project_id=".concat(e),method:"get"})}function i(e,t){return Object(a["a"])({url:"/check/CheckOp",method:"post",data:{apply_id:e,checked:t}})}function s(){return Object(a["a"])({url:"/project/list",method:"get"})}function l(e){return Object(a["a"])({url:"/worktime/Export?project_id=".concat(e),method:"get"})}function c(e){return Object(a["a"])({url:"/sign/project",method:"post",data:e})}function u(e){return Object(a["a"])({method:"post",url:"/project/detail",data:e})}},2971:function(e,t,n){},"707c":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{margin:"20px"}},[n("h1",[e._v("Project# "+e._s(e.projectID)+": "+e._s(e.title))]),e._v(" "),e.ownername?n("el-card",[n("i",{staticClass:"el-icon-user-solid"}),e._v(" 发起人："+e._s(e.ownername)+" \n  ")]):e._e(),e._v(" "),e.content?n("el-card",[n("i",{staticClass:"el-icon-info"}),e._v(" 项目详情："+e._s(e.content)+" \n  ")]):e._e(),e._v(" "),e.requirements?n("el-card",[n("p",[n("i",{staticClass:"el-icon-star-off"}),e._v(" 需求："+e._s(e.requirements)+"\n    ")])]):e._e(),e._v(" "),e.finished||e.started?e._e():n("el-card",[n("p",[e._v("报名列表：")]),e._v(" "),e.applyList&&0==e.applyList.length?n("p",[e._v("还没有人报名QAQ")]):e._e(),e._v(" "),e.applyList&&e.applyList.length>0?n("checkform",{attrs:{applyList:e.applyList}}):e._e()],1),e._v(" "),e.started&&!e.finished?n("el-card",[n("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 发起签到\n    "),n("signform",{attrs:{jobs:e.jobs,projectID:e.projectID}})],1):e._e(),e._v(" "),e.finished?n("el-card",[n("p",[e._v(" \n      已经结项：查看工时记录\n      "),n("el-button",{on:{click:e.exportExcel}},[n("i",{staticClass:"el-icon-download"}),e._v("导出工时为excel\n      ")])],1),e._v(" "),e.applyList&&0==e.applyList.length?n("p",[e._v("没有记录~")]):e._e(),e._v(" "),e.applyList&&0!=e.applyList.length?n("table",{staticStyle:{"text-align":"center"}},[n("tr",[e._v("jie\n        "),n("td",[e._v("参加人员")]),e._v(" "),n("td",[e._v("岗位")])]),e._v(" "),e._l(e.applyList,(function(t){return n("tr",{key:t.index},[n("td",[e._v(e._s(t.user.name))]),e._v(" "),n("td",[e._v(e._s(t.job.job_name))])])}))],2):e._e()]):e._e()],1)},r=[],o=(n("28a5"),n("24d2")),i=n("5c96"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[n("el-form-item",{attrs:{label:"签到标题",prop:"title"}},[n("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"签到描述",prop:"content"}},[n("el-input",{model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"签到起止时间",prop:"time_range"}},[n("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00"]},model:{value:e.form.time_range,callback:function(t){e.$set(e.form,"time_range",t)},expression:"form.time_range"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"岗位安排",prop:"jobs"}},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleJobsCheckAll},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),n("el-checkbox-group",{model:{value:e.form.jobs,callback:function(t){e.$set(e.form,"jobs",t)},expression:"form.jobs"}},e._l(e.jobs,(function(t){return n("el-checkbox",{key:t.id,attrs:{label:t.id},on:{change:e.handleJobsCheck}},[e._v(e._s(t.job_name))])})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"签到地点",prop:"pos"}},[n("qqmap",{on:{input:e.handleMapInput}})],1),e._v(" "),n("el-button",{staticStyle:{margin:"10px 0px"},attrs:{type:"primary"},on:{click:e.startSign}},[e._v("发起签到")])],1)},l=[],c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"padd20"},[n("mapselect",{attrs:{mapcenter:e.centerLatLng,oldmarker:e.oldMarker},on:{mapclick:e.pointChange}})],1)},u=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticStyle:{overflow:"hidden"}},[n("section",[n("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",[n("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入签到地点"},nativeOn:{keyup:function(t){return e.inputChange(t)}},model:{value:e.inputVal,callback:function(t){e.inputVal=t},expression:"inputVal"}})],1)],1)],1)],1)]),e._v(" "),e._m(0)])},d=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mapWrap"},[n("div",{staticClass:"qqmap",attrs:{id:"qqmapCont"}}),e._v(" "),n("div",{staticClass:"lngTips"})])}],m=n("7618"),f={props:{mapcenter:{type:String,default:"40.0024431613261,116.3263320"},oldmarker:{type:String,default:"40.0024431613261,116.3263320"},inputDefault:{type:String,default:""}},data:function(){return{qqmap:"",premarker:"",marker:"",inputVal:"",latlngCurrent:""}},mounted:function(){var e=this;this.inputVal=this.inputDefault,this.oldmarker&&(this.latlngCurrent=this.oldmarker||this.mapcenter),"object"==("undefined"===typeof qq?"undefined":Object(m["a"])(qq))?e.createMap():this.loadQQmap(),window.onMapFileLoad=function(){console.log("qqmap加载完成"),e.createMap()}},watch:{oldmarker:function(e,t){e&&(console.log(Object(m["a"])(e)),this.latlngCurrent=e,this.qqmap&&this.createMarker())},inputDefault:function(e,t){console.log("默认地址变成：",e),this.inputVal=e},inputVal:function(e,t){this.$emit("mapclick",{text:this.inputVal})}},methods:{loadQQmap:function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://map.qq.com/api/js?v=2.exp&key=S3YBZ-GFP36-QGJSK-MEV46-I66IS-QQFRJ&callback=onMapFileLoad",document.body.appendChild(e)},search:function(){var e=this,t=new qq.maps.Geocoder({complete:function(t){e.qqmap.setCenter(t.detail.location),e.qqmap.setZoom(12)}}),n=this.inputVal;console.log("搜索地址：",n),t.getLocation(n)},inputChange:function(){this.$emit("addr",this.inputVal)},createMap:function(){var e=this,t=this;this.qqmap=new qq.maps.Map(document.getElementById("qqmapCont"),{center:new qq.maps.LatLng(t.mapcenter.split(",")[0],t.mapcenter.split(",")[1]),zoom:16}),setTimeout((function(){e.createMarker(),e.bindMapEvent()}),500)},createMarker:function(){var e=this;if(e.premarker&&e.premarker.setMap(null),this.oldmarker)console.log("编辑模式：",this.oldmarker),e.qqmap.setCenter(new qq.maps.LatLng(e.oldmarker.split(",")[0],e.oldmarker.split(",")[1])),e.premarker=new qq.maps.Marker({position:new qq.maps.LatLng(e.oldmarker.split(",")[0],e.oldmarker.split(",")[1]),map:e.qqmap});else{var t=new qq.maps.CityService({complete:function(t){e.qqmap.setCenter(t.detail.latLng)}});t.searchLocalCity()}},bindMapEvent:function(){var e=this;qq.maps.event.addListener(e.qqmap,"click",(function(t){e.marker&&e.marker.setMap(null),e.premarker&&e.premarker.setMap(null),e.$emit("mapclick",{pos:t.latLng,text:e.inputVal}),e.latlngCurrent=t.latLng.lat+","+t.latLng.lng,e.marker=new qq.maps.Marker({position:t.latLng,map:e.qqmap})}));var t=document.querySelector(".lngTips");window.getComputedStyle(document.querySelector(".mapWrap")).width;qq.maps.event.addListener(e.qqmap,"mousemove",(function(e){t.style.display="block",t.style.top=e.pixel.y+10+"px",t.style.left=e.pixel.x+15+"px",t.innerText="点击选择此坐标"})),qq.maps.event.addListener(e.qqmap,"mouseout",(function(e){t.style.display="none"}))}}},h=f,v=(n("c5d4"),n("2877")),b=Object(v["a"])(h,p,d,!1,null,null,null),g=b.exports,_={name:"qqmap",components:{mapselect:g},data:function(){return{pointName:"清华大学",qqmap:null,centerLatLng:"40.0024431613261,116.3263320",oldMarker:"40.0024431613261,116.3263320",newMarker:null}},methods:{pointChange:function(e){this.$emit("input",e)}}},j=_,q=(n("07f0"),Object(v["a"])(j,c,u,!1,null,null,null)),k=q.exports,y={name:"signform",props:["jobs","projectID"],components:{qqmap:k},created:function(){for(var e in this.alljobs=[],this.jobs)this.alljobs.push(this.jobs[e].id);console.log(this.alljobs)},data:function(){var e=function(e,t,n){t&&t.text?n():n(new Error("请在上方输入框填写活动地址"))};return{form:{title:void 0,content:void 0,time_range:void 0,jobs:[],pos:{pos:"40.0024431613261,116.3263320",text:void 0}},alljobs:void 0,isIndeterminate:void 0,checkAll:void 0,rules:{title:{required:!0,message:"请输入签到标题",trigger:"blur"},content:{required:!0,message:"请输入签到描述",trigger:"blur"},time_range:{required:!0,message:"请输入起止时间",trigger:"blur"},jobs:{required:!0,message:"请至少安排一个岗位",trigger:"blur"},pos:{required:!0,validator:e,trigger:"blur"}}}},methods:{handleJobsCheck:function(e){var t=this.form.jobs.length;this.checkAll=t===this.jobs.length,this.isIndeterminate=t>0&&t<this.jobs.length},handleJobsCheckAll:function(e){this.form.jobs=e?this.alljobs:[],this.isIndeterminate=!1},startSign:function(){var e=this;console.log(),this.$refs["form"].validate((function(t){if(t){var n={title:e.form.title,content:e.form.content,begin_time:new Date(e.form.time_range[0]).toISOString(),end_time:new Date(e.form.time_range[1]).toISOString(),jobs:e.form.jobs,project:e.projectID,longitude:e.form.pos.pos.lng,latitude:e.form.pos.pos.lat,position:e.form.pos.text};console.log(n),Object(o["g"])(n).then((function(e){Object(i["Message"])({message:"成功发起签到",type:"success",duration:5e3})})).catch((function(e){Object(i["Message"])({message:"发起签到失败："+e,type:"error",duration:5e3})}))}}))},handleMapInput:function(e){this.form.pos.text=e.text,e.pos&&(this.form.pos.pos=e.pos),e.text&&this.$refs.form.clearValidate("pos"),console.log("收到了",this.form.pos)}}},w=y,L=Object(v["a"])(w,s,l,!1,null,null,null),x=L.exports,O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.applyList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{label:"姓名",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.user.name))]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"岗位",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.job.job_name))]}}])}),e._v(" "),n("el-table-column",{attrs:{width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"success",disabled:"P"==t.row.status},on:{click:function(n){return e.handleOne(!0,t.row.id)}}},[n("i",{staticClass:"el-icon-check"}),e._v("\n        通过"+e._s(t.row.status)+"\n      ")])]}}])},[n("template",{slot:"header"},[n("el-button",{attrs:{type:"success",disabled:0==e.selected.length},on:{click:function(t){return e.handleAll(!0)}}},[e._v("\n        通过选中项\n      ")])],1)],2),e._v(" "),n("el-table-column",{attrs:{width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"danger",disabled:"N"==t.row.status},on:{click:function(n){return e.handleOne(!1,t.row.id)}}},[n("i",{staticClass:"el-icon-close"}),e._v("\n        拒绝"+e._s(t.row.status)+"\n      ")])]}}])},[n("template",{slot:"header"},[n("el-button",{attrs:{type:"danger",disabled:0==e.selected.length},on:{click:function(t){return e.handleAll(!1)}}},[e._v("\n        拒绝选中项\n      ")])],1)],2)],1)},C=[],M={name:"checkform",props:["applyList"],created:function(){console.log(this.applyList),this.isIndeterminate=!1,this.checkAll=!1,this.selected=[]},data:function(){return{isIndeterminate:void 0,checkAll:void 0,selected:void 0}},methods:{handleOne:function(e,t,n){var a=this;for(var r in console.log(e,t),this.selected)if(console.log(this.selected[r]),this.selected[r].id==t){if(console.log(this.selected[r].status,"状态"),"P"==this.selected[r].status&&1==e||"N"==this.selected[r].status&&0==e)return void(n||Object(i["Message"])({message:e?"已审核通过":"已拒绝请求",type:"success",duration:5e3}));break}Object(o["a"])(t,e).then((function(r){for(var o in n||Object(i["Message"])({message:e?"已审核通过":"已拒绝请求",type:"success",duration:5e3}),a.applyList)a.applyList[o].id==t&&(a.applyList[o].status=e?"P":"N")})).catch((function(e){n||Object(i["Message"])({message:e,type:"error",duration:5e3})}))},handleSelectionChange:function(e){console.log(e),this.selected=e},handleAll:function(e){var t=!1;for(var n in this.selected){var a=this.selected[n].id;this.handleOne(e,a,t),t=!0}}}},S=M,I=Object(v["a"])(S,O,C,!1,null,null,null),E=I.exports,$={name:"Project",components:{signform:x,checkform:E},data:function(){return{ownername:void 0,projectID:void 0,title:void 0,content:void 0,cover:void 0,require_num:void 0,status:void 0,requirements:void 0,form:void 0,time:void 0,deadline:void 0,applyList:void 0,finished:void 0,started:void 0,jobs:void 0}},methods:{handleRecord:function(e){var t=e.target.id.substr(1,e.target.id.length),n=e.target.id.substr(0,1),a=this;if("A"!=t)Object(o["a"])(parseInt(t),"Y"==n).then((function(e){for(var r in Object(i["Message"])({message:"Y"==n?"已审核通过":"已审核拒绝",type:"success",duration:5e3}),a.applyList)if(a.applyList[r].id==parseInt(t)){a.applyList[r].status="Y"==n?"P":"N";break}})).catch((function(e){Object(i["Message"])({message:"获取错误Error request"+e,type:"error",duration:5e3})}));else for(var r in a.applyList)a.applyList.selected&&Object(o["a"])(parseInt(t),"Y"==n).catch((function(e){Object(i["Message"])({message:"获取错误Error request"+e,type:"error",duration:5e3})}))},exportExcel:function(){Object(o["b"])(this.projectID).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=t;var a=e.headers["content-disposition"].split("filename=");n.setAttribute("download",a[1]),document.body.appendChild(n),n.click()})).catch((function(e){Object(i["Message"])({message:"Error request"+e,type:"error",duration:5e3})}))}},created:function(){var e=this;console.log("project页面加载完毕,route为",this.$route),this.$data.projectID=this.$route.query.projectID;var t=this;Object(o["d"])(this.projectID).then((function(n){console.log("项目详情",n),e.ownername=n.data.webuser,t.title=n.data.title,t.content=n.data.content,t.cover=n.data.cover,t.require_num=n.data.require_num,t.status=n.data.status,t.requirements=n.data.requirements,t.form=n.data.form,t.time=n.data.time,t.deadline=n.data.deadline,t.finished=n.data.finished,t.jobs=n.data.job_set;var a=new Date(n.data.deadline).getTime(),r=(new Date).getTime();t.started=!(a>r),Object(o["c"])(e.projectID).then((function(e){console.log("报名信息：",e.data),t.applyList=e.data})).catch((function(e){Object(i["Message"])({message:"获取错误Error request"+e,type:"error",duration:5e3})}))})).catch((function(e){Object(i["Message"])({message:e,type:"error",duration:5e3})}))}},D=$,A=(n("1ec0"),Object(v["a"])(D,a,r,!1,null,"2a3c2fde",null));t["default"]=A.exports},b775:function(e,t,n){"use strict";var a=n("bc3a"),r=n.n(a),o=(n("5c96"),r.a.create({baseURL:"/api",timeout:5e3}));o.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),o.interceptors.response.use((function(e){return 200!==e.status?Promise.reject(new Error(e.data||"Error")):e}),(function(e){return Promise.reject(e)})),t["a"]=o},c5d4:function(e,t,n){"use strict";var a=n("2971"),r=n.n(a);r.a},e4fb:function(e,t,n){},fa33:function(e,t,n){}}]);