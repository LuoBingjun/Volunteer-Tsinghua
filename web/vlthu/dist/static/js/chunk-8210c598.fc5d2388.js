(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8210c598"],{"07f0":function(t,e,n){"use strict";var a=n("fa33"),r=n.n(a);r.a},"0ca3":function(t,e,n){"use strict";var a=n("e01e"),r=n.n(a);r.a},"24d2":function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return s})),n.d(e,"e",(function(){return i})),n.d(e,"b",(function(){return l})),n.d(e,"g",(function(){return c})),n.d(e,"f",(function(){return u}));var a=n("b775");function r(t){return Object(a["a"])({url:"/project/detail?id=".concat(t),method:"get"})}function o(t){return Object(a["a"])({url:"/check/ViewApplyInfo?project_id=".concat(t),method:"get"})}function s(t,e){return Object(a["a"])({url:"/check/CheckOp",method:"post",data:{apply_id:t,checked:e}})}function i(){return Object(a["a"])({url:"/project/list",method:"get"})}function l(t){return Object(a["a"])({url:"/worktime/Export?project_id=".concat(t),method:"get"})}function c(t){return Object(a["a"])({url:"/sign/project",method:"post",data:t})}function u(t){return Object(a["a"])({method:"post",url:"/project/detail",data:t})}},2971:function(t,e,n){},"707c":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{margin:"40px"}},[n("h1",[t._v(t._s(t.title))]),t._v(" "),t.ownername?n("el-card",{staticStyle:{"margin-bottom":"10px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[n("i",{staticClass:"el-icon-user-solid"}),t._v(" 发起人\n      ")])]),t._v("\n    "+t._s(t.ownername)+"\n  ")]):t._e(),t._v(" "),t.content?n("el-card",{staticStyle:{"margin-bottom":"10px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[n("i",{staticClass:"el-icon-info"}),t._v(" 项目详情\n      ")])]),t._v("\n    "+t._s(t.content)+"\n  ")]):t._e(),t._v(" "),t.requirements?n("el-card",{staticStyle:{"margin-bottom":"10px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[n("i",{staticClass:"el-icon-star-off"}),t._v("\n        需求\n      ")])]),t._v("\n    "+t._s(t.requirements)+"\n  ")]):t._e(),t._v(" "),t.finished||t.started?t._e():n("el-card",{staticStyle:{"margin-bottom":"10px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[n("i",{staticClass:"el-icon-check"}),t._v("\n        报名审核\n      ")])]),t._v(" "),t.applyList&&0==t.applyList.length?n("p",[t._v("暂时还没有人报名QAQ")]):t._e(),t._v(" "),t.applyList&&t.applyList.length>0?n("checkform",{attrs:{applyList:t.applyList}}):t._e()],1),t._v(" "),t.started&&!t.finished?n("el-card",{staticStyle:{"margin-bottom":"10px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[n("i",{staticClass:"el-icon-circle-plus-outline"}),t._v(" 发起签到\n      ")])]),t._v(" "),n("signform",{attrs:{jobs:t.jobs,projectID:t.projectID}})],1):t._e(),t._v(" "),t.finished?n("el-card",{staticStyle:{"margin-bottom":"10px"}},[n("p",[t._v("\n      已经结项：查看工时记录\n      "),n("el-button",{on:{click:t.exportExcel}},[n("i",{staticClass:"el-icon-download"}),t._v("导出工时为excel\n      ")])],1),t._v(" "),t.applyList&&0==t.applyList.length?n("p",[t._v("没有记录~")]):t._e(),t._v(" "),t.applyList&&0!=t.applyList.length?n("table",{staticStyle:{"text-align":"center"}},[n("tr",[t._v("\n        jie\n        "),n("td",[t._v("参加人员")]),t._v(" "),n("td",[t._v("岗位")])]),t._v(" "),t._l(t.applyList,(function(e){return n("tr",{key:e.index},[n("td",[t._v(t._s(e.user.name))]),t._v(" "),n("td",[t._v(t._s(e.job.job_name))])])}))],2):t._e()]):t._e()],1)},r=[],o=(n("28a5"),n("24d2")),s=n("5c96"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules}},[n("el-form-item",{attrs:{label:"签到标题",prop:"title"}},[n("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"签到描述",prop:"content"}},[n("el-input",{model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"签到起止时间",prop:"time_range"}},[n("el-date-picker",{attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00"]},model:{value:t.form.time_range,callback:function(e){t.$set(t.form,"time_range",e)},expression:"form.time_range"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"岗位安排",prop:"jobs"}},[n("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleJobsCheckAll},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),n("el-checkbox-group",{model:{value:t.form.jobs,callback:function(e){t.$set(t.form,"jobs",e)},expression:"form.jobs"}},t._l(t.jobs,(function(e){return n("el-checkbox",{key:e.id,attrs:{label:e.id},on:{change:t.handleJobsCheck}},[t._v(t._s(e.job_name))])})),1)],1),t._v(" "),n("el-form-item",{attrs:{label:"签到地点",prop:"pos"}},[n("qqmap",{on:{input:t.handleMapInput}})],1),t._v(" "),n("el-button",{staticStyle:{margin:"10px 0px"},attrs:{type:"primary"},on:{click:t.startSign}},[t._v("发起签到")])],1)},l=[],c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"padd20"},[n("mapselect",{attrs:{mapcenter:t.centerLatLng,oldmarker:t.oldMarker},on:{mapclick:t.pointChange}})],1)},u=[],d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticStyle:{overflow:"hidden"}},[n("section",[n("el-col",{staticClass:"toolbar",staticStyle:{"padding-bottom":"0px"},attrs:{span:24}},[n("el-form",{attrs:{inline:!0}},[n("el-form-item",[n("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入签到地点"},nativeOn:{keyup:function(e){return t.inputChange(e)}},model:{value:t.inputVal,callback:function(e){t.inputVal=e},expression:"inputVal"}})],1)],1)],1)],1)]),t._v(" "),t._m(0)])},p=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"mapWrap"},[n("div",{staticClass:"qqmap",attrs:{id:"qqmapCont"}}),t._v(" "),n("div",{staticClass:"lngTips"})])}],m=n("7618"),f={props:{mapcenter:{type:String,default:"40.0024431613261,116.3263320"},oldmarker:{type:String,default:"40.0024431613261,116.3263320"},inputDefault:{type:String,default:""}},data:function(){return{qqmap:"",premarker:"",marker:"",inputVal:"",latlngCurrent:""}},mounted:function(){var t=this;this.inputVal=this.inputDefault,this.oldmarker&&(this.latlngCurrent=this.oldmarker||this.mapcenter),"object"==("undefined"===typeof qq?"undefined":Object(m["a"])(qq))?t.createMap():this.loadQQmap(),window.onMapFileLoad=function(){console.log("qqmap加载完成"),t.createMap()}},watch:{oldmarker:function(t,e){t&&(console.log(Object(m["a"])(t)),this.latlngCurrent=t,this.qqmap&&this.createMarker())},inputDefault:function(t,e){console.log("默认地址变成：",t),this.inputVal=t},inputVal:function(t,e){this.$emit("mapclick",{text:this.inputVal})}},methods:{loadQQmap:function(){var t=document.createElement("script");t.type="text/javascript",t.src="https://map.qq.com/api/js?v=2.exp&key=S3YBZ-GFP36-QGJSK-MEV46-I66IS-QQFRJ&callback=onMapFileLoad",document.body.appendChild(t)},search:function(){var t=this,e=new qq.maps.Geocoder({complete:function(e){t.qqmap.setCenter(e.detail.location),t.qqmap.setZoom(12)}}),n=this.inputVal;console.log("搜索地址：",n),e.getLocation(n)},inputChange:function(){this.$emit("addr",this.inputVal)},createMap:function(){var t=this,e=this;this.qqmap=new qq.maps.Map(document.getElementById("qqmapCont"),{center:new qq.maps.LatLng(e.mapcenter.split(",")[0],e.mapcenter.split(",")[1]),zoom:16}),setTimeout((function(){t.createMarker(),t.bindMapEvent()}),500)},createMarker:function(){var t=this;if(t.premarker&&t.premarker.setMap(null),this.oldmarker)console.log("编辑模式：",this.oldmarker),t.qqmap.setCenter(new qq.maps.LatLng(t.oldmarker.split(",")[0],t.oldmarker.split(",")[1])),t.premarker=new qq.maps.Marker({position:new qq.maps.LatLng(t.oldmarker.split(",")[0],t.oldmarker.split(",")[1]),map:t.qqmap});else{var e=new qq.maps.CityService({complete:function(e){t.qqmap.setCenter(e.detail.latLng)}});e.searchLocalCity()}},bindMapEvent:function(){var t=this;qq.maps.event.addListener(t.qqmap,"click",(function(e){t.marker&&t.marker.setMap(null),t.premarker&&t.premarker.setMap(null),t.$emit("mapclick",{pos:e.latLng,text:t.inputVal}),t.latlngCurrent=e.latLng.lat+","+e.latLng.lng,t.marker=new qq.maps.Marker({position:e.latLng,map:t.qqmap})}));var e=document.querySelector(".lngTips");window.getComputedStyle(document.querySelector(".mapWrap")).width;qq.maps.event.addListener(t.qqmap,"mousemove",(function(t){e.style.display="block",e.style.top=t.pixel.y+10+"px",e.style.left=t.pixel.x+15+"px",e.innerText="点击选择此坐标"})),qq.maps.event.addListener(t.qqmap,"mouseout",(function(t){e.style.display="none"}))}}},h=f,v=(n("c5d4"),n("2877")),b=Object(v["a"])(h,d,p,!1,null,null,null),g=b.exports,_={name:"qqmap",components:{mapselect:g},data:function(){return{pointName:"清华大学",qqmap:null,centerLatLng:"40.0024431613261,116.3263320",oldMarker:"40.0024431613261,116.3263320",newMarker:null}},methods:{pointChange:function(t){this.$emit("input",t)}}},j=_,q=(n("07f0"),Object(v["a"])(j,c,u,!1,null,null,null)),k=q.exports,y={name:"signform",props:["jobs","projectID"],components:{qqmap:k},created:function(){for(var t in this.alljobs=[],this.jobs)this.alljobs.push(this.jobs[t].id);console.log(this.alljobs)},data:function(){var t=function(t,e,n){e&&e.text?n():n(new Error("请在上方输入框填写活动地址"))};return{form:{title:void 0,content:void 0,time_range:void 0,jobs:[],pos:{pos:"40.0024431613261,116.3263320",text:void 0}},alljobs:void 0,isIndeterminate:void 0,checkAll:void 0,rules:{title:{required:!0,message:"请输入签到标题",trigger:"blur"},content:{required:!0,message:"请输入签到描述",trigger:"blur"},time_range:{required:!0,message:"请输入起止时间",trigger:"blur"},jobs:{required:!0,message:"请至少安排一个岗位",trigger:"blur"},pos:{required:!0,validator:t,trigger:"blur"}}}},methods:{handleJobsCheck:function(t){var e=this.form.jobs.length;this.checkAll=e===this.jobs.length,this.isIndeterminate=e>0&&e<this.jobs.length},handleJobsCheckAll:function(t){this.form.jobs=t?this.alljobs:[],this.isIndeterminate=!1},startSign:function(){var t=this;console.log(),this.$refs["form"].validate((function(e){if(e){var n={title:t.form.title,content:t.form.content,begin_time:new Date(t.form.time_range[0]).toISOString(),end_time:new Date(t.form.time_range[1]).toISOString(),jobs:t.form.jobs,project:t.projectID,longitude:t.form.pos.pos.lng,latitude:t.form.pos.pos.lat,position:t.form.pos.text};console.log(n),Object(o["g"])(n).then((function(t){Object(s["Message"])({message:"成功发起签到",type:"success",duration:5e3})})).catch((function(t){Object(s["Message"])({message:"发起签到失败："+t,type:"error",duration:5e3})}))}}))},handleMapInput:function(t){this.form.pos.text=t.text,t.pos&&(this.form.pos.pos=t.pos),t.text&&this.$refs.form.clearValidate("pos"),console.log("收到了",this.form.pos)}}},w=y,x=Object(v["a"])(w,i,l,!1,null,null,null),L=x.exports,C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.applyList,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),n("el-table-column",{attrs:{label:"姓名",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.user.name))]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"岗位",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.job.job_name))]}}])}),t._v(" "),n("el-table-column",{attrs:{width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"success",disabled:"P"==e.row.status},on:{click:function(n){return t.handleOne(!0,e.row.id)}}},[n("i",{staticClass:"el-icon-check"}),t._v("\n        通过"+t._s(e.row.status)+"\n      ")])]}}])},[n("template",{slot:"header"},[n("el-button",{attrs:{type:"success",disabled:0==t.selected.length},on:{click:function(e){return t.handleAll(!0)}}},[t._v("\n        通过选中项\n      ")])],1)],2),t._v(" "),n("el-table-column",{attrs:{width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"danger",disabled:"N"==e.row.status},on:{click:function(n){return t.handleOne(!1,e.row.id)}}},[n("i",{staticClass:"el-icon-close"}),t._v("\n        拒绝"+t._s(e.row.status)+"\n      ")])]}}])},[n("template",{slot:"header"},[n("el-button",{attrs:{type:"danger",disabled:0==t.selected.length},on:{click:function(e){return t.handleAll(!1)}}},[t._v("\n        拒绝选中项\n      ")])],1)],2)],1)},O=[],S={name:"checkform",props:["applyList"],created:function(){console.log(this.applyList),this.isIndeterminate=!1,this.checkAll=!1,this.selected=[]},data:function(){return{isIndeterminate:void 0,checkAll:void 0,selected:void 0}},methods:{handleOne:function(t,e,n){var a=this;for(var r in console.log(t,e),this.selected)if(console.log(this.selected[r]),this.selected[r].id==e){if(console.log(this.selected[r].status,"状态"),"P"==this.selected[r].status&&1==t||"N"==this.selected[r].status&&0==t)return void(n||Object(s["Message"])({message:t?"已审核通过":"已拒绝请求",type:"success",duration:5e3}));break}Object(o["a"])(e,t).then((function(r){for(var o in n||Object(s["Message"])({message:t?"已审核通过":"已拒绝请求",type:"success",duration:5e3}),a.applyList)a.applyList[o].id==e&&(a.applyList[o].status=t?"P":"N")})).catch((function(t){n||Object(s["Message"])({message:t,type:"error",duration:5e3})}))},handleSelectionChange:function(t){console.log(t),this.selected=t},handleAll:function(t){var e=!1;for(var n in this.selected){var a=this.selected[n].id;this.handleOne(t,a,e),e=!0}}}},M=S,I=Object(v["a"])(M,C,O,!1,null,null,null),E=I.exports,$={name:"Project",components:{signform:L,checkform:E},data:function(){return{ownername:void 0,projectID:void 0,title:void 0,content:void 0,cover:void 0,require_num:void 0,status:void 0,requirements:void 0,form:void 0,time:void 0,deadline:void 0,applyList:void 0,finished:void 0,started:void 0,jobs:void 0}},methods:{handleRecord:function(t){var e=t.target.id.substr(1,t.target.id.length),n=t.target.id.substr(0,1),a=this;if("A"!=e)Object(o["a"])(parseInt(e),"Y"==n).then((function(t){for(var r in Object(s["Message"])({message:"Y"==n?"已审核通过":"已审核拒绝",type:"success",duration:5e3}),a.applyList)if(a.applyList[r].id==parseInt(e)){a.applyList[r].status="Y"==n?"P":"N";break}})).catch((function(t){Object(s["Message"])({message:"获取错误Error request"+t,type:"error",duration:5e3})}));else for(var r in a.applyList)a.applyList.selected&&Object(o["a"])(parseInt(e),"Y"==n).catch((function(t){Object(s["Message"])({message:"获取错误Error request"+t,type:"error",duration:5e3})}))},exportExcel:function(){Object(o["b"])(this.projectID).then((function(t){var e=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=e;var a=t.headers["content-disposition"].split("filename=");n.setAttribute("download",a[1]),document.body.appendChild(n),n.click()})).catch((function(t){Object(s["Message"])({message:"Error request"+t,type:"error",duration:5e3})}))}},created:function(){var t=this;console.log("project页面加载完毕,route为",this.$route),this.$data.projectID=this.$route.query.projectID;var e=this;Object(o["d"])(this.projectID).then((function(n){console.log("项目详情",n),t.ownername=n.data.webuser,e.title=n.data.title,e.content=n.data.content,e.cover=n.data.cover,e.require_num=n.data.require_num,e.status=n.data.status,e.requirements=n.data.requirements,e.form=n.data.form,e.time=n.data.time,e.deadline=n.data.deadline,e.finished=n.data.finished,e.jobs=n.data.job_set;var a=new Date(n.data.deadline).getTime(),r=(new Date).getTime();e.started=!(a>r),Object(o["c"])(t.projectID).then((function(t){console.log("报名信息：",t.data),e.applyList=t.data})).catch((function(t){Object(s["Message"])({message:"获取错误Error request"+t,type:"error",duration:5e3})}))})).catch((function(t){Object(s["Message"])({message:t,type:"error",duration:5e3})}))}},D=$,A=(n("0ca3"),Object(v["a"])(D,a,r,!1,null,"fb0dad54",null));e["default"]=A.exports},b775:function(t,e,n){"use strict";var a=n("bc3a"),r=n.n(a),o=(n("5c96"),r.a.create({baseURL:"/api",timeout:5e3}));o.interceptors.request.use((function(t){return t}),(function(t){return Promise.reject(t)})),o.interceptors.response.use((function(t){return 200!==t.status?Promise.reject(new Error(t.data||"Error")):t}),(function(t){return Promise.reject(t)})),e["a"]=o},c5d4:function(t,e,n){"use strict";var a=n("2971"),r=n.n(a);r.a},e01e:function(t,e,n){},fa33:function(t,e,n){}}]);